<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®šå­˜è¨ˆç®—èˆ‡æé†’å°å¹«æ‰‹ ğŸ’°</title>
    <!-- å¼•å…¥ Tailwind CSS (æ¨£å¼) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ Vue 3 (é‚è¼¯) -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen p-4 md:p-8">

    <div id="app" class="max-w-3xl mx-auto">
        
        <!-- æ¨™é¡Œå€ -->
        <header class="mb-8 text-center">
            <h1 class="text-3xl font-bold text-indigo-600 mb-2">å®šå­˜è¨ˆç®—èˆ‡æé†’å°å¹«æ‰‹ ğŸ¦</h1>
            <p class="text-gray-500">è¨ˆç®—åˆ©æ¯ã€ä¿å­˜è¨˜éŒ„ï¼Œä¸¦ä¸€éµåŠ å…¥ Google æ—¥æ›†</p>
        </header>

        <!-- è¼¸å…¥å€å¡Š -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8 border border-gray-100">
            <h2 class="text-xl font-bold mb-4 text-gray-700 flex items-center">
                <span>ğŸ“ æ–°å¢å®šå­˜</span>
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">å­˜æ¬¾é‡‘é¡ (å…ƒ)</label>
                    <input type="number" v-model.number="form.amount" class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="ä¾‹å¦‚: 100000">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">å¹´åˆ©ç‡ (%)</label>
                    <input type="number" step="0.01" v-model.number="form.rate" class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="ä¾‹å¦‚: 1.7">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">èµ·å­˜æ—¥æœŸ</label>
                    <input type="date" v-model="form.startDate" class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">å­˜æ¬¾æœŸé–“ (æœˆ)</label>
                    <select v-model.number="form.months" class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                        <option value="3">3 å€‹æœˆ</option>
                        <option value="6">6 å€‹æœˆ</option>
                        <option value="12">1 å¹´ (12å€‹æœˆ)</option>
                        <option value="24">2 å¹´ (24å€‹æœˆ)</option>
                        <option value="36">3 å¹´ (36å€‹æœˆ)</option>
                    </select>
                </div>
            </div>
            <button @click="addDeposit" class="mt-6 w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-lg transition duration-200 shadow-md">
                è¨ˆç®—ä¸¦å„²å­˜
            </button>
        </div>

        <!-- è¨˜éŒ„åˆ—è¡¨å€å¡Š -->
        <div v-if="deposits.length > 0" class="space-y-4">
            <h2 class="text-xl font-bold text-gray-700 mb-2">ğŸ“Š å­˜æ¬¾è¨˜éŒ„</h2>
            
            <div v-for="(item, index) in deposits" :key="index" class="bg-white rounded-xl shadow p-5 border-l-4 border-indigo-500 relative group">
                <button @click="removeDeposit(index)" class="absolute top-3 right-3 text-gray-300 hover:text-red-500 transition">âœ•</button>
                
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                    <div>
                        <div class="text-2xl font-bold text-gray-800">NT$ {{ formatNumber(item.amount) }}</div>
                        <div class="text-sm text-gray-500 mt-1">
                            åˆ©ç‡: <span class="font-medium text-indigo-600">{{ item.rate }}%</span> | 
                            æœŸé–“: {{ item.months }} å€‹æœˆ
                        </div>
                        <div class="text-xs text-gray-400 mt-1">
                            èµ·å­˜: {{ item.startDate }} â åˆ°æœŸ: <span class="text-indigo-600 font-bold">{{ item.endDate }}</span>
                        </div>
                    </div>

                    <div class="bg-gray-50 p-3 rounded-lg text-right min-w-[140px]">
                        <div class="text-xs text-gray-500">é ä¼°åˆ©æ¯</div>
                        <div class="text-lg font-bold text-green-600">+{{ formatNumber(item.interest) }}</div>
                        <div class="text-xs text-gray-500 mt-1">æœ¬åˆ©å’Œ</div>
                        <div class="font-medium text-gray-700">{{ formatNumber(item.total) }}</div>
                    </div>
                </div>

                <!-- Google Calendar æŒ‰éˆ• -->
                <div class="mt-4 pt-3 border-t border-gray-100">
                    <a :href="getCalendarUrl(item)" target="_blank" class="inline-flex items-center text-sm text-indigo-600 hover:text-indigo-800 font-medium transition">
                        ğŸ“… åŠ å…¥ Google æ—¥æ›†æé†’
                        <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                    </a>
                </div>
            </div>
        </div>

        <div v-else class="text-center py-12 text-gray-400">
            <p>ç›®å‰æ²’æœ‰å­˜æ¬¾è¨˜éŒ„ï¼Œè©¦è‘—æ–°å¢ä¸€ç­†å§ï¼</p>
        </div>

    </div>

    <script>
        const { createApp, ref, onMounted, watch } = Vue;

        createApp({
            setup() {
                // è¡¨å–®é è¨­å€¼
                const form = ref({
                    amount: 100000,
                    rate: 1.6,
                    startDate: new Date().toISOString().split('T')[0],
                    months: 12
                });

                const deposits = ref([]);

                // åˆå§‹åŒ–ï¼šå¾ LocalStorage è®€å–è³‡æ–™
                onMounted(() => {
                    const saved = localStorage.getItem('myBankDeposits');
                    if (saved) {
                        deposits.value = JSON.parse(saved);
                    }
                });

                // ç›£è½è³‡æ–™è®Šå‹•ä¸¦å­˜æª”
                watch(deposits, (newVal) => {
                    localStorage.setItem('myBankDeposits', JSON.stringify(newVal));
                }, { deep: true });

                // è¨ˆç®—åˆ°æœŸæ—¥
                const calculateEndDate = (start, months) => {
                    const date = new Date(start);
                    date.setMonth(date.getMonth() + months);
                    return date.toISOString().split('T')[0];
                };

                // æ–°å¢å­˜æ¬¾é‚è¼¯
                const addDeposit = () => {
                    if (!form.value.amount || !form.value.rate || !form.value.startDate) {
                        alert('è«‹å¡«å¯«å®Œæ•´è³‡è¨Š');
                        return;
                    }

                    const interest = Math.round(form.value.amount * (form.value.rate / 100) * (form.value.months / 12));
                    const endDate = calculateEndDate(form.value.startDate, form.value.months);

                    deposits.value.unshift({
                        amount: form.value.amount,
                        rate: form.value.rate,
                        months: form.value.months,
                        startDate: form.value.startDate,
                        endDate: endDate,
                        interest: interest,
                        total: form.value.amount + interest,
                        id: Date.now() // å”¯ä¸€è­˜åˆ¥ç¢¼
                    });
                };

                const removeDeposit = (index) => {
                    if(confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†è¨˜éŒ„å—ï¼Ÿ')) {
                        deposits.value.splice(index, 1);
                    }
                };

                // æ•¸å­—æ ¼å¼åŒ– (åŠ é€—è™Ÿ)
                const formatNumber = (num) => {
                    return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                };

                // ç”Ÿæˆ Google Calendar é€£çµ
                const getCalendarUrl = (item) => {
                    // æ ¼å¼åŒ–æ—¥æœŸç‚º YYYYMMDD
                    const start = item.endDate.replace(/-/g, '');
                    // çµæŸæ™‚é–“è¨­ç‚ºç•¶å¤©+1å¤© (å…¨å¤©äº‹ä»¶)
                    const nextDay = new Date(item.endDate);
                    nextDay.setDate(nextDay.getDate() + 1);
                    const end = nextDay.toISOString().split('T')[0].replace(/-/g, '');

                    const title = encodeURIComponent(`ğŸ’° å®šå­˜åˆ°æœŸï¼šæœ¬é‡‘ ${formatNumber(item.amount)}`);
                    const details = encodeURIComponent(`æœ¬é‡‘ï¼š${formatNumber(item.amount)}\nåˆ©æ¯ï¼š${formatNumber(item.interest)}\næœ¬åˆ©å’Œï¼š${formatNumber(item.total)}\nåˆ©ç‡ï¼š${item.rate}%`);
                    
                    return `https://www.google.com/calendar/render?action=TEMPLATE&text=${title}&dates=${start}/${end}&details=${details}`;
                };

                return {
                    form,
                    deposits,
                    addDeposit,
                    removeDeposit,
                    formatNumber,
                    getCalendarUrl
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
