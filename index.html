<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¯å¹£å®šå­˜è¨ˆç®—æ©Ÿ (é€±/æœˆç‰ˆ) ğŸ’°</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen p-4 md:p-8">

    <div id="app" class="max-w-3xl mx-auto">
        
        <!-- æ¨™é¡Œå€ -->
        <header class="mb-8 text-center">
            <h1 class="text-3xl font-bold text-teal-700 mb-2">æ¸¯å¹£å®šå­˜è¨ˆç®—æ©Ÿ ğŸ‡­ğŸ‡°</h1>
            <p class="text-slate-500">æ”¯æ´é€±/æœˆåˆ¶è¨ˆç®—ï¼Œä¸€éµåŠ å…¥ Google Calendar</p>
        </header>

        <!-- è¼¸å…¥å€å¡Š -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8 border border-slate-100">
            <h2 class="text-xl font-bold mb-4 text-slate-700 flex items-center">
                <span>ğŸ“ æ–°å¢å®šå­˜</span>
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-slate-600 mb-1">å­˜æ¬¾é‡‘é¡ (HKD)</label>
                    <div class="relative">
                        <span class="absolute left-3 top-2 text-slate-400">$</span>
                        <input type="number" v-model.number="form.amount" class="w-full pl-7 p-2 border rounded-lg focus:ring-2 focus:ring-teal-500 outline-none" placeholder="ä¾‹å¦‚: 50000">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-600 mb-1">å¹´åˆ©ç‡ (%)</label>
                    <input type="number" step="0.01" v-model.number="form.rate" class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-teal-500 outline-none" placeholder="ä¾‹å¦‚: 4.2">
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-600 mb-1">èµ·å­˜æ—¥æœŸ</label>
                    <input type="date" v-model="form.startDate" class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-teal-500 outline-none">
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-600 mb-1">å­˜æ¬¾æœŸé–“</label>
                    <select v-model="form.period" class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-teal-500 outline-none">
                        <option value="1w">1 é€±</option>
                        <option value="3w">3 é€±</option>
                        <option value="1m">1 å€‹æœˆ</option>
                        <option value="3m">3 å€‹æœˆ</option>
                        <option value="6m">6 å€‹æœˆ</option>
                    </select>
                </div>
            </div>
            <button @click="addDeposit" class="mt-6 w-full bg-teal-600 hover:bg-teal-700 text-white font-bold py-3 rounded-lg transition duration-200 shadow-md">
                è¨ˆç®—ä¸¦å„²å­˜
            </button>
        </div>

        <!-- è¨˜éŒ„åˆ—è¡¨å€å¡Š -->
        <div v-if="deposits.length > 0" class="space-y-4">
            <h2 class="text-xl font-bold text-slate-700 mb-2">ğŸ“Š å­˜æ¬¾è¨˜éŒ„</h2>
            
            <div v-for="(item, index) in deposits" :key="index" class="bg-white rounded-xl shadow p-5 border-l-4 border-teal-500 relative group">
                <button @click="removeDeposit(index)" class="absolute top-3 right-3 text-slate-300 hover:text-red-500 transition" title="åˆªé™¤è¨˜éŒ„">âœ•</button>
                
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                    <div>
                        <div class="text-2xl font-bold text-slate-800">HK$ {{ formatNumber(item.amount) }}</div>
                        <div class="text-sm text-slate-500 mt-1">
                            åˆ©ç‡: <span class="font-medium text-teal-600">{{ item.rate }}%</span> | 
                            æœŸé–“: <span class="font-medium text-slate-700">{{ getPeriodLabel(item.period) }}</span>
                        </div>
                        <div class="text-xs text-slate-400 mt-1">
                            èµ·å­˜: {{ item.startDate }} â åˆ°æœŸ: <span class="text-teal-600 font-bold">{{ item.endDate }}</span>
                        </div>
                    </div>

                    <div class="bg-slate-50 p-3 rounded-lg text-right min-w-[140px]">
                        <div class="text-xs text-slate-500">é ä¼°åˆ©æ¯</div>
                        <div class="text-lg font-bold text-green-600">+HK$ {{ formatNumber(item.interest) }}</div>
                        <div class="text-xs text-slate-500 mt-1">æœ¬åˆ©å’Œ</div>
                        <div class="font-medium text-slate-700">HK$ {{ formatNumber(item.total) }}</div>
                    </div>
                </div>

                <!-- Google Calendar æŒ‰éˆ• -->
                <div class="mt-4 pt-3 border-t border-slate-100">
                    <a :href="getCalendarUrl(item)" target="_blank" class="inline-flex items-center text-sm text-teal-600 hover:text-teal-800 font-medium transition">
                        ğŸ“… åŠ å…¥ Google æ—¥æ›†æé†’
                        <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                    </a>
                </div>
            </div>
        </div>

        <div v-else class="text-center py-12 text-slate-400">
            <p>ç›®å‰æ²’æœ‰å­˜æ¬¾è¨˜éŒ„ï¼Œè©¦è‘—æ–°å¢ä¸€ç­†å§ï¼</p>
        </div>

    </div>

    <script>
        const { createApp, ref, onMounted, watch } = Vue;

        createApp({
            setup() {
                // è¡¨å–®é è¨­å€¼
                const form = ref({
                    amount: 10000, 
                    rate: 3.8,
                    startDate: new Date().toISOString().split('T')[0],
                    period: '1m' // é è¨­ 1 å€‹æœˆ
                });

                const deposits = ref([]);

                // æœŸé–“é¡¯ç¤ºå°ç…§è¡¨
                const periodLabels = {
                    '1w': '1 é€±',
                    '3w': '3 é€±',
                    '1m': '1 å€‹æœˆ',
                    '3m': '3 å€‹æœˆ',
                    '6m': '6 å€‹æœˆ'
                };

                // åˆå§‹åŒ–ï¼šå¾ LocalStorage è®€å–è³‡æ–™
                onMounted(() => {
                    const saved = localStorage.getItem('hkBankDeposits_v2'); // æ›´æ–° Key é¿å…èˆŠè³‡æ–™æ ¼å¼è¡çª
                    if (saved) {
                        deposits.value = JSON.parse(saved);
                    }
                });

                // ç›£è½è³‡æ–™è®Šå‹•ä¸¦å­˜æª”
                watch(deposits, (newVal) => {
                    localStorage.setItem('hkBankDeposits_v2', JSON.stringify(newVal));
                }, { deep: true });

                // æ ¸å¿ƒé‚è¼¯ï¼šè¨ˆç®—åˆ°æœŸæ—¥èˆ‡åˆ©æ¯
                const calculateDetails = (amount, rate, startDate, periodCode) => {
                    const unit = periodCode.slice(-1); // 'w' or 'm'
                    const value = parseInt(periodCode); // æ•¸å€¼ (1, 3, 6...)
                    
                    let endDateObj = new Date(startDate);
                    let interest = 0;

                    if (unit === 'w') {
                        // é€±è¨ˆç®—ï¼šå¤©æ•¸ = é€±æ•¸ * 7
                        const days = value * 7;
                        // åˆ°æœŸæ—¥ï¼šåŠ å¤©æ•¸
                        endDateObj.setDate(endDateObj.getDate() + days);
                        // åˆ©æ¯ï¼šæœ¬é‡‘ * åˆ©ç‡ * (å¤©æ•¸ / 365)
                        interest = Math.round(amount * (rate / 100) * (days / 365));
                    } else {
                        // æœˆè¨ˆç®—
                        // åˆ°æœŸæ—¥ï¼šåŠ æœˆæ•¸
                        endDateObj.setMonth(endDateObj.getMonth() + value);
                        // åˆ©æ¯ï¼šæœ¬é‡‘ * åˆ©ç‡ * (æœˆæ•¸ / 12)
                        interest = Math.round(amount * (rate / 100) * (value / 12));
                    }

                    return {
                        endDate: endDateObj.toISOString().split('T')[0],
                        interest: interest
                    };
                };

                // æ–°å¢å­˜æ¬¾
                const addDeposit = () => {
                    if (!form.value.amount || !form.value.rate || !form.value.startDate) {
                        alert('è«‹å¡«å¯«å®Œæ•´è³‡æ–™');
                        return;
                    }

                    const details = calculateDetails(
                        form.value.amount, 
                        form.value.rate, 
                        form.value.startDate, 
                        form.value.period
                    );

                    deposits.value.unshift({
                        amount: form.value.amount,
                        rate: form.value.rate,
                        period: form.value.period, // å„²å­˜ä»£ç¢¼ (å¦‚ '3w')
                        startDate: form.value.startDate,
                        endDate: details.endDate,
                        interest: details.interest,
                        total: form.value.amount + details.interest,
                        id: Date.now()
                    });
                };

                const removeDeposit = (index) => {
                    if(confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†è¨˜éŒ„å—ï¼Ÿ')) {
                        deposits.value.splice(index, 1);
                    }
                };

                const formatNumber = (num) => {
                    return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                };

                const getPeriodLabel = (code) => {
                    return periodLabels[code] || code;
                };

                const getCalendarUrl = (item) => {
                    const start = item.endDate.replace(/-/g, '');
                    const nextDay = new Date(item.endDate);
                    nextDay.setDate(nextDay.getDate() + 1);
                    const end = nextDay.toISOString().split('T')[0].replace(/-/g, '');

                    const title = encodeURIComponent(`ğŸ’° å®šå­˜åˆ°æœŸï¼šHK$ ${formatNumber(item.amount)}`);
                    const details = encodeURIComponent(`æœ¬é‡‘ï¼šHK$ ${formatNumber(item.amount)}\nåˆ©æ¯ï¼šHK$ ${formatNumber(item.interest)}\næœ¬åˆ©å’Œï¼šHK$ ${formatNumber(item.total)}\nåˆ©ç‡ï¼š${item.rate}%\næœŸé–“ï¼š${getPeriodLabel(item.period)}`);
                    
                    return `https://www.google.com/calendar/render?action=TEMPLATE&text=${title}&dates=${start}/${end}&details=${details}`;
                };

                return {
                    form,
                    deposits,
                    addDeposit,
                    removeDeposit,
                    formatNumber,
                    getPeriodLabel,
                    getCalendarUrl
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
